<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account System</title>
</head>
<body>
    <h2>Sign Up</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="createAccount()">Sign Up</button>

    <h2>Login</h2>
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginPassword" placeholder="Password">
    <button onclick="login()">Login</button>

    <script type="module">
        // Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

        // Your Firebase Config
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Create Account Function
        async function createAccount() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Get the last user ID and increment it
                const usersRef = collection(db, "users");
                const snapshot = await getDocs(usersRef);
                const lastUserID = snapshot.size; // Number of users = last ID

                // Save user data in Firestore
                await setDoc(doc(usersRef, user.uid), {
                    email: user.email,
                    userID: lastUserID + 1
                });

                alert("Account created! Redirecting...");
                window.location.href = `User.html?ID=${lastUserID + 1}`;
            } catch (error) {
                alert(error.message);
            }
        }

        // Login Function
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const userDoc = await getDocs(collection(db, "users"));
                let userID = 0;

                userDoc.forEach((doc) => {
                    if (doc.id === userCredential.user.uid) {
                        userID = doc.data().userID;
                    }
                });

                alert("Logged in! Redirecting...");
                window.location.href = `User.html?ID=${userID}`;
            } catch (error) {
                alert(error.message);
            }
        }

        // Attach functions to global scope
        window.createAccount = createAccount;
        window.login = login;
    </script>
</body>
</html>
